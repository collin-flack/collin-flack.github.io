<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Routine Tracker</title>
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; text-align: center; background: #222; color: #fff; }
    #timer { font-size: 4em; margin: 30px 0; }
    #status { font-size: 2em; margin: 8px 0; }
    #block { font-size: 1.5em; margin: 10px 0; }
  </style>
</head>
<body>
  <h1>Routine Tracker</h1>
  <div id="status"></div>
  <div id="block"></div>
  <div id="timer"></div>

<script>
  const WORK_MIN = 45, BREAK_MIN = 15, TOTAL_BLOCKS = 4;
  const START_UTC_HOUR = 12, START_UTC_MINUTE = 0; // 12:00 UTC == 7:00 AM America/Chicago (summer)

  function getTodayStartUTC() {
    const now = new Date();
    const start = new Date(Date.UTC(
      now.getUTCFullYear(),
      now.getUTCMonth(),
      now.getUTCDate(),
      START_UTC_HOUR,
      START_UTC_MINUTE,
      0
    ));
    return start;
  }

  function getTomorrowStartUTC() {
    const t = getTodayStartUTC();
    t.setUTCDate(t.getUTCDate() + 1);
    return t;
  }

  function getBlocks(startUTC) {
    const blocks = [];
    let cursor = new Date(startUTC);
    for (let i = 1; i <= TOTAL_BLOCKS; i++) {
      const workEnd = new Date(cursor.getTime() + WORK_MIN * 60 * 1000);
      blocks.push({ type: "Work", block: i, start: new Date(cursor), end: workEnd });
      cursor = new Date(workEnd);
      if (i < TOTAL_BLOCKS) {
        const breakEnd = new Date(cursor.getTime() + BREAK_MIN * 60 * 1000);
        blocks.push({ type: "Break", block: i, start: new Date(cursor), end: breakEnd });
        cursor = new Date(breakEnd);
      }
    }
    return blocks;
  }

  function formatTimeDiff(ms) {
    const totalSecs = Math.max(0, Math.floor(ms / 1000));
    const h = String(Math.floor(totalSecs / 3600)).padStart(2, '0');
    const m = String(Math.floor((totalSecs % 3600) / 60)).padStart(2, '0');
    const s = String(totalSecs % 60).padStart(2, '0');
    return `${h}:${m}:${s}`;
  }

  function updateTimer() {
    const now = new Date();
    let startUTC = getTodayStartUTC();

    // If before start time today
    if (now < startUTC) {
      document.getElementById('status').textContent = `Routine starts daily at ${String(START_UTC_HOUR).padStart(2,'0')}:${String(START_UTC_MINUTE).padStart(2,'0')} UTC`;
      document.getElementById('block').textContent = '';
      document.getElementById('timer').textContent = formatTimeDiff(startUTC - now);
      return;
    }

    // If after start time, process blocks
    const blocks = getBlocks(startUTC);
    for (const b of blocks) {
      if (now < b.end) {
        document.getElementById('status').textContent = b.type === "Work"
          ? `Work Block ${b.block}`
          : `Break after Block ${b.block}`;
        document.getElementById('block').textContent = b.type === "Work"
          ? `Block: ${b.block} of ${TOTAL_BLOCKS}`
          : `Break (${BREAK_MIN} min)`;
        document.getElementById('timer').textContent = formatTimeDiff(b.end - now);
        return;
      }
    }

    // Routine Complete - show next start countdown
    const nextStart = getTomorrowStartUTC();
    document.getElementById('status').textContent = 'Routine Complete';
    document.getElementById('block').textContent = 'Next routine in:';
    document.getElementById('timer').textContent = formatTimeDiff(nextStart - now);
  }

  updateTimer();
  setInterval(updateTimer, 1000);
</script>
</body>
</html>
