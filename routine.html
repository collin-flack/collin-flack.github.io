<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Routine Tracker</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="projects.html">Projects</a></li>
        <li><a href="routine.html" class="active">Routine</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h1>Routine Tracker</h1>
    <div id="status" style="font-size: 2em; margin: 1rem 0;"></div>
    <div id="block" style="font-size: 1.5em; margin-bottom: 1rem;"></div>
    <div id="timer" style="font-size: 4em; margin: 2rem 0;"></div>
  </main>

  <footer>
    <p>&copy; 2025 Collin Flack. All rights reserved.</p>
  </footer>

  <!-- Audio elements -->
  <audio id="audio5MinWarning" src="audio/5mins.wav" preload="auto"></audio>
  <audio id="audioBreakStart" src="audio/breakstart.wav" preload="auto"></audio>
  <audio id="audioWorkStart" src="audio/workstart.wav" preload="auto"></audio>

<script>
  const WORK_MIN = 45, BREAK_MIN = 15, TOTAL_BLOCKS = 4;
  const START_UTC_HOUR = 12, START_UTC_MINUTE = 0;

  const audio5MinWarning = document.getElementById('audio5MinWarning');
  const audioBreakStart = document.getElementById('audioBreakStart');
  const audioWorkStart = document.getElementById('audioWorkStart');

  let hasWarned5Min = false;
  let hasPlayedBreakStart = false;
  let hasPlayedWorkStart = false;

  function getTodayStartUTC() {
    const now = new Date();
    return new Date(Date.UTC(
      now.getUTCFullYear(),
      now.getUTCMonth(),
      now.getUTCDate(),
      START_UTC_HOUR,
      START_UTC_MINUTE,
      0
    ));
  }

  function getTomorrowStartUTC() {
    const t = getTodayStartUTC();
    t.setUTCDate(t.getUTCDate() + 1);
    return t;
  }

  function getBlocks(startUTC) {
    const blocks = [];
    let cursor = new Date(startUTC);
    for (let i = 1; i <= TOTAL_BLOCKS; i++) {
      const workEnd = new Date(cursor.getTime() + WORK_MIN * 60 * 1000);
      blocks.push({ type: "Work", block: i, start: new Date(cursor), end: workEnd });
      cursor = new Date(workEnd);
      if (i < TOTAL_BLOCKS) {
        const breakEnd = new Date(cursor.getTime() + BREAK_MIN * 60 * 1000);
        blocks.push({ type: "Break", block: i, start: new Date(cursor), end: breakEnd });
        cursor = new Date(breakEnd);
      }
    }
    return blocks;
  }

  function formatTimeDiff(ms) {
    const totalSecs = Math.max(0, Math.floor(ms / 1000));
    const h = String(Math.floor(totalSecs / 3600)).padStart(2, '0');
    const m = String(Math.floor((totalSecs % 3600) / 60)).padStart(2, '0');
    const s = String(totalSecs % 60).padStart(2, '0');
    return `${h}:${m}:${s}`;
  }

  function updateTimer() {
    const now = new Date();
    let startUTC = getTodayStartUTC();

    if (now < startUTC) {
      document.getElementById('status').textContent = `Routine starts daily at ${String(START_UTC_HOUR).padStart(2,'0')}:${String(START_UTC_MINUTE).padStart(2,'0')} UTC`;
      document.getElementById('block').textContent = '';
      document.getElementById('timer').textContent = formatTimeDiff(startUTC - now);
      hasWarned5Min = false;
      hasPlayedBreakStart = false;
      hasPlayedWorkStart = false;
      return;
    }

    const blocks = getBlocks(startUTC);
    for (const b of blocks) {
      if (now < b.end) {
        document.getElementById('status').textContent = b.type === "Work"
          ? `Work Block ${b.block}`
          : `Break after Block ${b.block}`;
        document.getElementById('block').textContent = b.type === "Work"
          ? `Block: ${b.block} of ${TOTAL_BLOCKS}`
          : `Break (${BREAK_MIN} min)`;
        document.getElementById('timer').textContent = formatTimeDiff(b.end - now);

        if (b.type === "Work") {
          const timeLeft = (b.end - now) / 60000; // minutes left
          if (timeLeft <= 5 && !hasWarned5Min) {
            audio5MinWarning.play();
            hasWarned5Min = true;
          }
        } else {
          hasWarned5Min = false;
        }

        if (b.type === "Break" && Math.abs(now - b.start) < 1000 && !hasPlayedBreakStart) {
          audioBreakStart.play();
          hasPlayedBreakStart = true;
        }

        if (b.type === "Work" && Math.abs(now - b.start) < 1000 && !hasPlayedWorkStart) {
          audioWorkStart.play();
          hasPlayedWorkStart = true;
          hasPlayedBreakStart = false;
          hasWarned5Min = false;
        }

        return;
      }
    }

    const nextStart = getTomorrowStartUTC();
    document.getElementById('status').textContent = 'Routine Complete';
    document.getElementById('block').textContent = 'Next routine in:';
    document.getElementById('timer').textContent = formatTimeDiff(nextStart - now);

    hasWarned5Min = false;
    hasPlayedBreakStart = false;
    hasPlayedWorkStart = false;
  }

  updateTimer();
  setInterval(updateTimer, 1000);
</script>
</body>
</html>
